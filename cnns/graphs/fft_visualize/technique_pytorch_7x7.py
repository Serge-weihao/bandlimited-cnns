import numpy as np
import torch
from cnns.nnlib.utils.shift_DC_component import shift_DC
from cnns.nnlib.pytorch_layers.pytorch_utils import compress_2D_index_forward

torch.manual_seed(31)
x = torch.tensor([[6., 5., 0., 2., 4., 1., 3.0],
        [4., 2., 8., 5., 6., 8., -1.0],
        [0., 0., 4., 2., 0., 2., -1.0],
        [2., 9., 9., 9., 1., 6., -1.0],
        [3., 0., 9., 4., 6., 6., -1.0],
        [7., 3., 4., 7., 9., 0., -1.0],
        [7., 3., 4., 7., 9., 0., -1.0]])
x = x.to(torch.float)
print("sum of x: ", x.sum().item())
print("x: ", x)

xfft = torch.rfft(x, onesided=False, signal_ndim=2, normalized=False)
print("xfft: ", xfft)

# xfft:  tensor([[[153.0000,   0.0000],
#          [-16.0000,  -3.4641],
#          [  0.0000,  10.3923],
#          [ 11.0000,   0.0000],
#          [  0.0000, -10.3923],
#          [-16.0000,   3.4641]],
#
#         [[ -4.5000,  14.7224],
#          [  7.5000,   7.7942],
#          [ 18.0000, -12.1244],
#          [ 16.5000,  12.9904],
#          [ -1.5000,  23.3827],
#          [ 12.0000, -15.5885]],
#
#         [[  4.5000, -19.9186],
#          [ 14.0000, -12.1244],
#          [ 16.5000,   0.8660],
#          [-20.5000,  -0.8660],
#          [-12.0000,  19.0526],
#          [  3.5000,  12.9904]],
#
#         [[-45.0000,   0.0000],
#          [  9.0000,   5.1962],
#          [ -3.0000,   1.7321],
#          [  9.0000,   0.0000],
#          [ -3.0000,  -1.7321],
#          [  9.0000,  -5.1962]],
#
#         [[  4.5000,  19.9186],
#          [  3.5000, -12.9904],
#          [-12.0000, -19.0526],
#          [-20.5000,   0.8660],
#          [ 16.5000,  -0.8660],
#          [ 14.0000,  12.1244]],
#
#         [[ -4.5000, -14.7224],
#          [ 12.0000,  15.5885],
#          [ -1.5000, -23.3827],
#          [ 16.5000, -12.9904],
#          [ 18.0000,  12.1244],
#          [  7.5000,  -7.7942]]])

xfft_dc = shift_DC(xfft, onesided=False)
print("xfft_dc: ", xfft_dc)

xfft = torch.rfft(x, onesided=True, signal_ndim=2, normalized=False)
print("xfft onesided: ", xfft)

xfft_dc = shift_DC(xfft, onesided=True)
print("xfft dc onesided: ", xfft_dc)

xfft_compress1 = compress_2D_index_forward(xfft, index_forward=3)
xfft_compress1_dc = shift_DC(xfft_compress1, onesided=True)
print("xfft compress1: ", xfft_compress1_dc)

xfft_compress2 = compress_2D_index_forward(xfft, index_forward=2)
xfft_compress2_dc = shift_DC(xfft_compress2, onesided=True)
print("xfft compress2: ", xfft_compress2_dc)

# xfft_dc:tensor(
# [[[-2.4555e+01,-6.5890e+00][1.9215e+00,9.1022e-01][5.1078e+00,-4.1197e+00][-2.5310e+01,2.6301e+01][2.7605e+01,6.4019e+00][1.1874e+01,5.1060e+00][-1.2552e+00,-5.6371e+00]],
# [[4.2699e+00,1.9766e+01][-1.1488e+01,-4.2382e+00][2.1012e+01,-7.0153e+00][1.3648e+01,6.2156e+00][-2.8358e+00,-6.5455e+00][-8.5260e+00,-9.0086e+00][-1.3539e+01,7.0852e+00]],
# [[-1.9086e+01,-5.7731e+00][2.5435e+01,-2.5818e+01][1.2543e+01,-8.9651e+00][-4.8379e+00,-1.5632e+01][1.0781e+01,1.6600e+01][1.6122e+01,-3.5792e+01][6.6138e+00,8.1526e+00]],
# [[3.4115e+01,9.4548e-02][1.4081e+01,1.7083e+01][-3.6696e+01,3.4604e+01][1.8000e+02,0.0000e+00][-3.6696e+01,-3.4604e+01][1.4081e+01,-1.7083e+01][3.4115e+01,-9.4548e-02]],
# [[6.6138e+00,-8.1526e+00][1.6122e+01,3.5792e+01][1.0781e+01,-1.6600e+01][-4.8379e+00,1.5632e+01][1.2543e+01,8.9651e+00][2.5435e+01,2.5818e+01][-1.9086e+01,5.7731e+00]],
# [[-1.3539e+01,-7.0852e+00][-8.5260e+00,9.0086e+00][-2.8358e+00,6.5455e+00][1.3648e+01,-6.2156e+00][2.1012e+01,7.0153e+00][-1.1488e+01,4.2382e+00][4.2699e+00,-1.9766e+01]],
# [[-1.2552e+00,5.6371e+00][1.1874e+01,-5.1060e+00][2.7605e+01,-6.4019e+00][-2.5310e+01,-2.6301e+01][5.1078e+00,4.1197e+00][1.9215e+00,-9.1022e-01][-2.4555e+01,6.5890e+00]]])
#
#
# xfftdconesided:tensor(
# [[[-2.5310e+01,2.6301e+01][2.7605e+01,6.4019e+00][1.1874e+01,5.1060e+00][-1.2552e+00,-5.6371e+00]],
# [[1.3648e+01,6.2156e+00][-2.8358e+00,-6.5455e+00][-8.5260e+00,-9.0086e+00][-1.3539e+01,7.0852e+00]],
# [[-4.8379e+00,-1.5632e+01][1.0781e+01,1.6600e+01][1.6122e+01,-3.5792e+01][6.6138e+00,8.1526e+00]],
# [[1.8000e+02,0.0000e+00][-3.6696e+01,-3.4604e+01][1.4081e+01,-1.7083e+01][3.4115e+01,-9.4548e-02]],
# [[-4.8379e+00,1.5632e+01][1.2543e+01,8.9651e+00][2.5435e+01,2.5818e+01][-1.9086e+01,5.7731e+00]],
# [[1.3648e+01,-6.2156e+00][2.1012e+01,7.0153e+00][-1.1488e+01,4.2382e+00][4.2699e+00,-1.9766e+01]],
# [[-2.5310e+01,-2.6301e+01][5.1078e+00,4.1197e+00][1.9215e+00,-9.1022e-01][-2.4555e+01,6.5890e+00]]])
#
# xfftcompress1:tensor(
# [[[13.6477,6.2156][-2.8358,-6.5455][-8.5260,-9.0086]],
# [[-4.8379,-15.6318][10.7811,16.6002][16.1223,-35.7920]],
# [[180.0000,0.0000][-36.6963,-34.6036][14.0808,-17.0831]],
# [[-4.8379,15.6318][12.5432,8.9651][25.4346,25.8179]],
# [[13.6477,-6.2156][21.0124,7.0153][-11.4885,4.2382]]])
#
# xfftcompress2:tensor(
# [[[-4.8379,-15.6318][10.7811,16.6002]],
# [[180.0000,0.0000][-36.6963,-34.6036]],
# [[-4.8379,15.6318][12.5432,8.9651]]])